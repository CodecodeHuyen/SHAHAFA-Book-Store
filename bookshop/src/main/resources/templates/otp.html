<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Xác minh OTP</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <style>
        .otp-input {
            letter-spacing: 6px;
            font-size: 1.5rem;
            text-align: center;
        }
        .resend-btn {
            font-size: 0.9rem;
        }
    </style>
</head>

<body class="bg-light">

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <div class="card shadow-sm">
                <div class="card-header text-center">
                    <h4>Xác minh tài khoản</h4>
                </div>

                <div class="card-body">

                    <!-- ERROR -->
                    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
                    <!-- MESSAGE -->
                    <div th:if="${message}"  th:text="${message}"></div>

                    <!-- GUIDE -->
                    <p class="text-muted">
                        Đã gửi mã OTP xác minh tài khoản về email của bạn.
                        Vui lòng kiểm tra email và nhập mã vào bên dưới để tiếp tục.
                        <br>
                        Mã OTP còn hiệu lực trong
                        <strong><span id="countdown">04:00</span></strong>.
                    </p>

                    <!-- FORM VERIFY OTP -->
                    <form th:action="@{/auth/verify-otp}"
                          th:object="${otpRequest}"
                          method="post">

                        <!-- hidden email -->
                        <input type="hidden" th:field="*{email}"/>

                        <div class="mb-3">
                            <label class="form-label">Mã OTP (6 chữ số)</label>
                            <input type="text"
                                   maxlength="6"
                                   pattern="[0-9]{6}"
                                   inputmode="numeric"
                                   autocomplete="one-time-code"
                                   th:field="*{otp}"
                                   class="form-control otp-input"
                                   placeholder="••••••">
                            <small class="text-danger" th:errors="*{otp}"></small>
                        </div>

                        <div class="d-grid">
                            <button class="btn btn-primary" type="submit">
                                Xác minh
                            </button>
                        </div>
                    </form>

                    <!-- RESEND OTP -->
                    <form th:action="@{/auth/resend-otp}"
                          method="post"
                          class="mt-3 text-center">

                        <input type="hidden" name="email" th:value="${otpRequest.email}"/>
                        <input type="hidden" name="name" th:value="${name}"/>


                        <button class="btn btn-link resend-btn" type="submit">
                            Gửi lại mã
                        </button>
                    </form>

                </div>
            </div>

        </div>
    </div>
</div>

<!-- COUNTDOWN SCRIPT -->
<script>
    let seconds = 240; // 4 phút
    const countdownEl = document.getElementById("countdown");

    setInterval(() => {
        const min = String(Math.floor(seconds / 60)).padStart(2, '0');
        const sec = String(seconds % 60).padStart(2, '0');
        countdownEl.textContent = `${min}:${sec}`;
        if (seconds > 0) seconds--;
    }, 1000);
</script>


</body>
</html>
